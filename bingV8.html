<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>

<head>
  <title>Bing Map V8</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

  <!-- CSS -->
  <link rel="stylesheet" href="css/maps.css" />
</head>

<body>
  <nav class="main-nav">
    <ul>
      <li><a href="index.html">Open Street Map</a></li>
      <li><a href="bingV7.html">Bing Map V7 - Minimap</a></li>
      <li><a href="bingV8.html" class="active">Bing Map V8 - Clusters</a></li>
    </ul>
  </nav>
  <div id='bing-map' class="map"></div>
  <div class="input-container">
    <input type="button" value="Add Places" onclick="addPushpins();" />
    <input type="button" value="Add Lines" onclick="addLines();" />
  </div>


  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.6.2.js" type="text/javascript"></script>
  <script type="text/javascript">
    const myCredentials = 'Amx6HKtetEO_AyjRNmnXMGm9lnf47JsB3MCFFjjLOmpoIuPh-v5VlMA_ti5lKj6K';
    var map = null;
    var places = [];

    // function initMap() {
    //   map = new Microsoft.Maps.Map(document.getElementById('bing-map'), {
    //     credentials: myCredentials,
    //     center: new Microsoft.Maps.Location(39.393486, -98.100769),
    //     zoom: 3
    //   });
    //   loadMapScenario();
    //   Microsoft.Maps.registerModule("MinimapModule", "scripts/MinimapModule.js", { styleURLs: ["MinimapModule.css"] });
    //   Microsoft.Maps.loadModule("MinimapModule", { callback: function () { new MinimapModule(map, myCredentials, true); } });
    // }



    function loadMapScenario() {
      map = new Microsoft.Maps.Map(document.getElementById('bing-map'), {
        credentials: myCredentials,
        center: new Microsoft.Maps.Location(39.393486, -98.100769),
        zoom: 3
      });

      Microsoft.Maps.loadModule('Microsoft.Maps.Clustering', function () {
        // Creating sample Pushpin data within map view
        var pushpins = Microsoft.Maps.TestDataGenerator.getPushpins(2000, map.getBounds());
        var clusterLayer = new Microsoft.Maps.ClusterLayer(pushpins, { gridSize: 100 });
        map.layers.insert(clusterLayer);
      });
      // Microsoft.Maps.registerModule('MinimapModule', 'scripts/MinimapModule.js', { styleURLs: ['MinimapModule.css'] });
      // Microsoft.Maps.loadModule('MinimapModule', { callback: function () { 
      //   new MinimapModule(map, myCredentials, true);
      // } });

    }

    

    function addPushpins() {
      var limit = 5;
      var bounds = map.getBounds();
      latlon = bounds.getNorthwest();
      var lat = latlon.latitude - bounds.height / 4;
      var lon = latlon.longitude + bounds.width / 4;
      var latDiff = bounds.height / 2;
      var lonDiff = bounds.width / 2;
      for (var i = 0; i < limit; i++) {
        var newLat = lat - (latDiff * Math.random());
        var newLon = lon + (lonDiff * Math.random());
        places.push({ lat: newLat, lon: newLon });
        var pushpin = new Microsoft.Maps.Pushpin(new Microsoft.Maps.Location(newLat, newLon), null);
        map.entities.push(pushpin);
      }
    }

    function addLines() {
      var points = places.map(p => new Microsoft.Maps.Location(p.lat, p.lon))
      var polyline = new Microsoft.Maps.Polyline(points);
      map.entities.push(polyline);
    }
  </script>

  <script type='text/javascript' src='http://www.bing.com/api/maps/mapcontrol?callback=loadMapScenario' async defer></script>
  <!--<script type="text/javascript" src="http://ecn.dev.virtualearth.net/mapcontrol/mapcontrol.ashx?v=7.0"></script>-->

</body>

</html>